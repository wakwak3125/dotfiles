# ウィンドウのインデックスを1から始める
set -g base-index 1

# ペインのインデックスを1から始める
setw -g pane-base-index 1

# status line を更新する間隔を5秒にする
set-option -g status-interval 5

# 50000まで履歴をもつ
set-option -g history-limit 50000

# Neovim連携: focus-events を有効化
set -g focus-events on

# ================================================
# keybind
# ================================================

# prefixキーをC-tに変更する
set -g prefix C-t

# C-bのキーバインドを解除する
unbind C-b

# キーストロークのディレイを減らす
set -sg escape-time 1

# 設定ファイルをリロードする
bind r source-file ~/.config/tmux/tmux.conf \; display-message "Reloaded!"

# マウス操作を有効にする
setw -g mouse on

# viのキーバインドを使用する
setw -g mode-keys vi

# 'v' で選択を始める
bind -T copy-mode-vi v send -X begin-selection

# fzf コマンドパレット風ウィンドウスイッチャー
bind w display-popup -E -w 85% -h 70% "~/.local/bin/tmux-switcher"

# vimのキーバインドでペインを移動する
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# 新規ペイン作成時に現在のディレクトリを維持する
# 画面分割のショートカットキーを|/-に変更
bind | split-window -hc "#{pane_current_path}"
bind - split-window -vc "#{pane_current_path}"

set-option -g set-titles on
set-option -g set-titles-string "#S / #W"

# ================================================
# Appearance
# ================================================

# 256色端末を使用する
# set-option -g default-terminal screen-256color
# set -g terminal-overrides 'xterm:colors=256'
# set -g default-terminal "tmux-256color"
# set -ag terminal-overrides ",xterm-256color:RGB"
set -g default-terminal "screen-256color"
set -ag terminal-overrides ",alacritty:RGB"

# アクティブなペインのみ白っぽく変更（真っ黒は232）
# set -g window-style 'bg=colour239'
# set -g window-active-style 'bg=colour234'

# enable visual notification
set-window-option -g monitor-activity on
set -g visual-activity on

set -g status-left-length 100
set -g status-right-length 100

#set -g @nord_tmux_show_status_content "0"
#set -g @nord_tmux_no_patched_font "1"
# precmd フックでブランチ名ベースの命名を行うため automatic-rename は無効化
set -g automatic-rename off

# ================================================
# Plugins
# ================================================

set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'tmux-plugins/tmux-open'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @continuum-restore 'off'
set -g @plugin 'tmux-plugins/tmux-battery'
set -g @plugin 'tmux-plugins/tmux-pain-control'
set -g @plugin 'tmux-plugins/tmux-prefix-highlight'
set -g @plugin "nordtheme/tmux"

set-environment -g PATH "/opt/homebrew/bin:/bin:/usr/bin"
run-shell '~/.tmux/plugins/tpm/tpm'

# プラグイン読み込み後にキーバインドを上書き
# (tmux-pain-control が c を new-window に割り当てるため)
bind C new-window -c "#{pane_current_path}"
bind c display-popup -E -w 80% -h 30% "~/.local/bin/claude-status dashboard"

